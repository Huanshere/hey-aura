# macOS 系统音频录制配置指南

## 概述

Hey Aura 的会议录音模式支持同时录制麦克风输入和系统音频输出，实现完整的会议内容捕获。在 macOS 系统上，由于系统安全限制，需要通过 BlackHole 虚拟音频设备来实现系统音频的录制。

## 为什么需要 BlackHole？

macOS 系统出于隐私保护，不允许应用程序直接捕获系统音频输出。BlackHole 是一个开源的虚拟音频驱动，它能够：
- 创建一个虚拟音频设备，捕获系统音频流
- 通过多输出设备同时路由音频到扬声器和录制设备
- 对系统完全透明，不影响正常的音频播放

## 安装步骤

### 步骤 1：安装必要工具

打开终端，执行以下命令：

```bash
# 安装 Homebrew（如果尚未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装音频设备切换工具
brew install switchaudio-osx

# 安装 BlackHole 2 通道版本
brew install blackhole-2ch
```

**重要提示**：安装完成后需要重启电脑，以确保音频驱动正确加载。

### 步骤 2：创建多输出设备

1. **打开音频 MIDI 设置**
   - 进入 **应用程序** → **实用工具** → **音频 MIDI 设置**
   - 或使用 Spotlight 搜索（Command + 空格）：输入"音频 MIDI 设置"

2. **创建多输出设备**
   - 点击窗口左下角的 **+** 按钮
   - 选择 **创建多输出设备**

3. **配置多输出设备**
   
   **关键步骤**：
   - **重命名设备**：右键点击新创建的"多输出设备"，选择"重命名"，将其改为 `hey-aura`（必须完全一致，包括小写和连字符）
   
   **设备选择**：
   在右侧的设备列表中，勾选以下设备：
   - ✅ **BlackHole 2ch**
   - ✅ **MacBook Pro 扬声器**（或您的主要输出设备）
   - ✅ **AirPods**（如果您使用蓝牙耳机）
   - ✅ 其他您常用的音频输出设备

4. **设置主设备**
   - 在设备列表中，右键点击 **BlackHole 2ch**
   - 选择 **将此设备用作时钟源**（设为主设备）
   - 这确保音频同步正确

5. **保存设置**
   - 其他所有设置保持默认
   - 关闭音频 MIDI 设置窗口

## 使用方法

### 开始会议录音

1. 右键点击 Hey Aura 系统托盘图标
2. 选择 **开始会议录音**
3. 系统会自动：
   - 记住当前的音频输出设备
   - 切换到 `hey-aura` 多输出设备
   - 开始录制麦克风和系统音频

### 结束会议录音

1. 右键点击系统托盘图标
2. 选择 **停止会议录音**
3. 系统会自动：
   - 停止录制并保存文件
   - 恢复到之前的音频输出设备
   - 生成转录文本

### 录音文件位置

录音文件保存在 `recordings/meetings/` 目录下：
- `.mp3` 格式的音频文件（包含麦克风和系统音频）
- `.txt` 格式的转录文本

## 注意事项

### 音量控制
- **录制期间无法调节音量**：多输出设备会继承切换前的音量设置
- **建议**：在开始录制前调整好合适的音量
- **解决方案**：如需调节音量，可暂停录制，切换回正常设备调节后再继续

### 常见问题

#### Q: 安装 BlackHole 后没有声音？
A: 确保在多输出设备中同时勾选了 BlackHole 和您的扬声器/耳机。

#### Q: 录制时听不到系统声音？
A: 检查多输出设备配置，确保您的输出设备（扬声器/耳机）已被勾选。

#### Q: 如何卸载 BlackHole？
A: 执行 `brew uninstall blackhole-2ch` 并删除音频 MIDI 设置中的多输出设备。

#### Q: 可以使用其他虚拟音频设备吗？
A: 理论上可以，但需要修改代码中的设备名称。BlackHole 是免费开源且最稳定的选择。

## 故障排除

### 1. 设备切换失败
如果自动切换失败，可以手动操作：
```bash
# 查看所有音频设备
SwitchAudioSource -a

# 手动切换到 hey-aura 设备
SwitchAudioSource -s "hey-aura"

# 切换回默认设备
SwitchAudioSource -s "MacBook Pro Speakers"
```

### 2. 录制无声音
检查以下几点：
1. BlackHole 是否正确安装（重启后生效）
2. 多输出设备名称是否为 `hey-aura`
3. BlackHole 是否设为主时钟源
4. 系统偏好设置中的麦克风权限

### 3. 性能问题
如果遇到音频延迟或卡顿：
1. 关闭不必要的应用程序
2. 检查 CPU 使用率
3. 考虑降低录制质量设置

## 支持

如遇到问题，请在 [GitHub Issues](https://github.com/Huanshere/hey-aura/issues) 提交反馈，并附上：
- macOS 版本
- 错误信息截图
- 音频 MIDI 设置截图